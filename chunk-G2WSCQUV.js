import{a as F,b as k,c as J}from"./chunk-SWYIOHFY.js";import"./chunk-R6GG5OYM.js";import{b as q,c as D}from"./chunk-ZGJ2SCUV.js";import{c as _}from"./chunk-4XPXTYOG.js";import{d as P,f as O}from"./chunk-2HFDSWQC.js";import"./chunk-XHLVS7FU.js";import"./chunk-JOWTQUES.js";import"./chunk-QZIL3RNM.js";import"./chunk-GKWLEOQ4.js";import"./chunk-ERB5ATM7.js";import"./chunk-OFW6W57A.js";import"./chunk-CGO7NXBT.js";import{c as I}from"./chunk-GXVKBTVT.js";import"./chunk-RSTVJZ7U.js";import"./chunk-JVM3WL52.js";import"./chunk-PJHEGPYG.js";import"./chunk-J2UA6UJD.js";import"./chunk-6GF7UK45.js";import{ba as R}from"./chunk-CHX6FGWD.js";import{c as w}from"./chunk-QPCBXCVC.js";import{e as j}from"./chunk-HNFNR3GG.js";import"./chunk-PUECT5W6.js";import"./chunk-POJFSOR5.js";import{Ac as g,Bc as a,Cb as b,Ec as E,Hb as s,Ib as l,Jb as u,Ob as m,_a as d,a as f,ea as n,hc as T,ic as M,kb as c,pb as S,w as C,xb as p,ya as v,za as y}from"./chunk-CELOEL42.js";var $={type:"object",properties:{stateSubscription:{type:"object",properties:{watchedScopes:{type:"object",properties:{global:{type:"array",items:{type:"string"}},local:{type:"array",items:{type:"string"}}},additionalProperties:!1},variables:{type:"object",additionalProperties:{}}},additionalProperties:!1},options:{type:"object",properties:{runCondition:{type:"boolean"},requests:{type:"array",items:{type:"object",properties:{fetcherId:{type:"string"},configs:{},interpolation:{type:"string",pattern:"^(<\\${)([\\s\\S]*?)(}\\$>)$"}},required:["fetcherId"],additionalProperties:!1}},onSuccess:{type:"array",items:{type:"object",properties:{type:{type:"string"},payload:{}},required:["type"],additionalProperties:!1}},parallel:{type:"boolean"}},required:["requests"],additionalProperties:!1},name:{type:"string"},description:{type:"string"}},required:["options","name","description"],additionalProperties:!1,description:"AppEditRemoteResourceSchema",$schema:"http://json-schema.org/draft-07/schema#"};var U=()=>({}),z=(()=>{class r{constructor(){this.#e=n(D),this.#t=n(j),this.#i=n(R),this.id=y.required(),this.visible=y.required(),this.editCancel=v(),this.loadingSig=a(()=>this.#e.isPending()),this.jsonSchemaConfig={schema:$,schemaId:"remoteResourceEditSchema"},this.#o=a(()=>{let e=this.id();return this.#e.entities().filter(t=>t.id===e)}),this.#r=a(()=>{let e=this.#o();return e.length<=0?null:(e.length>1&&console.warn(`Multiple UIE templates with the same ID of ${g(this.id)} detected. This could be an error. The first one will be selected for editing`),e[0])}),this.currentEditableFieldsSig=a(()=>{let e=this.#r();if(!e)return null;let{name:t,description:i,stateSubscription:o,options:h}=e;return{name:t,description:i,stateSubscription:o,options:h}})}#e;#t;#i;#o;#r;async updateUIElementTemplate(e){let t=JSON.parse(e),i=g(this.#r);if(!i)return;let o=f(f({},i),t);await this.#e.change(o),g(this.#e.error)?this.#i.add({severity:"error",summary:"Template saved failure",detail:"Your remote resource template could not be saved, please try again later or refresh the page",life:9999}):(this.#i.add({severity:"success",summary:"Template saved successfully",detail:"Your remote resource template has been successfully saved",life:3e3}),this.#t.updateTemplate(o))}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275cmp=c({type:r,selectors:[["prime-ng-playground-builder-feat-raw-remote-resource-template-editor-modal"]],inputs:{id:[1,"id"],visible:[1,"visible"]},outputs:{editCancel:"editCancel"},features:[T([R])],decls:2,vars:5,consts:[[3,"editCancel","save","isLoading","isOpen","jsonObj","schemaConfig"],[1,"toast"]],template:function(t,i){if(t&1&&(s(0,"prime-ng-playground-builder-feat-json-editor-modal",0),m("editCancel",function(){return i.editCancel.emit()})("save",function(h){return i.updateUIElementTemplate(h)}),l(),u(1,"p-toast",1)),t&2){let o;p("isLoading",i.loadingSig())("isOpen",i.visible())("jsonObj",(o=i.currentEditableFieldsSig())!==null&&o!==void 0?o:M(4,U))("schemaConfig",i.jsonSchemaConfig)}},dependencies:[J,F],styles:["[_nghost-%COMP%]{display:contents}[_nghost-%COMP%]     .p-dialog-mask{z-index:9998!important}[_nghost-%COMP%]   .toast[_ngcontent-%COMP%]{z-index:10000}"],changeDetection:0})}}return r})();function L(r,A){r&1&&(s(0,"div",1),u(1,"prime-ng-playground-shared-json-editor",3),l()),r&2&&(d(),p("configs",A))}var ue=(()=>{class r{constructor(){this.#e=n(w),this.#t=n(P),this.#i=n(O),this.currentRemoteResourceTemplateId=this.#t.snapshot.params.id,this.remoteResourceStateSig=_(this.#e.getRemoteResourceState(this.currentRemoteResourceTemplateId)),this.#o="editRawTemplate",this.isRawTemplateEditorModalOpenSig=_(this.#t.queryParams.pipe(C(e=>e[this.#o]==="true")),{initialValue:!1}),this.editorConfig={readonly:!0},this.#r=E({request:()=>({remoteResourceState:this.remoteResourceStateSig()}),loader:({request:e})=>{let{remoteResourceState:t}=e;return!t||t.status!=="completed"?Promise.resolve(void 0):k(JSON.stringify(t.result))}}),this.editorConfigSig=a(()=>{let e=this.#r.value();return e?{readonly:!0,initialValue:e}:null})}#e;#t;#i;#o;#r;toggleModal(e){this.#i.navigate([],{relativeTo:this.#t,queryParams:{[this.#o]:e?!0:null},queryParamsHandling:"merge"})}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275cmp=c({type:r,selectors:[["prime-ng-playground-builder-feat-edit-remote-resource-template"]],decls:3,vars:3,consts:[["aria-label","Open template editor","icon","pi pi-file-edit","iconPos","bottom","label","Open template editor",1,"open-template-editor-btn",3,"click"],[1,"editor-container"],[3,"editCancel","id","visible"],[3,"configs"]],template:function(t,i){if(t&1&&(s(0,"p-button",0),m("click",function(){return i.toggleModal(!0)}),l(),S(1,L,2,1,"div",1),s(2,"prime-ng-playground-builder-feat-raw-remote-resource-template-editor-modal",2),m("editCancel",function(){return i.toggleModal(!1)}),l()),t&2){let o;d(),b((o=i.editorConfigSig())?1:-1,o),d(),p("id",i.currentRemoteResourceTemplateId)("visible",i.isRawTemplateEditorModalOpenSig())}},dependencies:[z,I,q],styles:["[_nghost-%COMP%]{position:relative;display:flex;justify-content:center;align-items:center;height:calc(100vh - 50px)}[_nghost-%COMP%]   .editor-container[_ngcontent-%COMP%]{width:75vw;height:75vh}[_nghost-%COMP%]   .open-template-editor-btn[_ngcontent-%COMP%]{position:absolute;z-index:9997;top:1rem;right:1rem;opacity:.1;transition:opacity .2s ease-in}[_nghost-%COMP%]   .open-template-editor-btn[_ngcontent-%COMP%]:hover{opacity:1}"],changeDetection:0})}}return r})();export{ue as EditRemoteResourceTemplateComponent};
