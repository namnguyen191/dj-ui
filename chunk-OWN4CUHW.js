import{a as M,d as A,f as he,h as _e}from"./chunk-EWUWNZZG.js";import{d as Ee,g as fe,j as Ce,m as ge,p as Ie}from"./chunk-RNE5JESU.js";import{b as S,c as F}from"./chunk-SPYAYC6H.js";import{$a as te,$b as pe,Aa as U,Ab as $,Ac as v,Ba as ee,Bc as _,Cc as me,D as P,Dc as le,Fb as x,H as Q,J as Y,Kb as j,Lb as V,Nb as re,Ob as se,Pb as k,Q as K,Qc as ce,S as O,Sb as b,Sc as ue,T as z,U as G,V as J,Yc as de,_b as ae,bc as w,ca as d,f as D,g as y,gb as W,ha as X,hb as ne,i as B,ia as L,k as H,l as g,lb as oe,r as h,rb as I,s as T,ya as Z,zb as ie}from"./chunk-J33AFEAQ.js";import{a as C,b as N}from"./chunk-VKRCUX5N.js";var q=o=>{let{ele:l,attrName:e,attrValue:t}=o,n=l.parentElement;for(;n;){if(n.getAttribute(e)===t)return!0;n=n.parentElement}return!1};var Te=["uiElementVCR"];function xe(o,l){o&1&&k(0,null,0)}function be(o,l){o&1&&k(0)}function ve(o,l){if(o&1&&I(0,be,1,0,"ng-container",2),o&2){let e=b(4);$("ngComponentOutlet",e.uiElementLoadingComponent)}}function Se(o,l){o&1&&(j(0,"span"),w(1,"Loading UI component...."),V())}function Re(o,l){if(o&1&&I(0,ve,1,1,"ng-container")(1,Se,2,0,"span"),o&2){let e=b(3);x(e.uiElementLoadingComponent?0:1)}}function ye(o,l){if(o&1&&(re(0),I(1,xe,2,0,"ng-container")(2,Re,2,1),se()),o&2){let e=l.ngIf;te(),x(e.status==="loaded"?1:2)}}function Oe(o,l){if(o&1&&I(0,ye,3,1,"ng-container",1),o&2){let e=b();$("ngIf",e.uiElementTemplate())}}function Le(o,l){o&1&&(j(0,"span"),w(1,"Infinte loop in rendering element detected"),V())}var et=(()=>{class o{#o;#i;#e;#t;#r;#s;#a;#n;#p;constructor(){this.#o=d(_e),this.#i=d(Ie),this.#e=d(Ce),this.#t=d(X),this.#r=d(fe),this.#s=d(ee),this.uiElementInstance=U.required(),this.requiredComponentSymbols=U([]),this.uiElementTemplateId=_(()=>this.uiElementInstance().uiElementTemplateId),this.uiElementVCR=ne("uiElementVCR",{read:W}),this.uiElementTemplate=M(()=>this.#i.getTemplate(this.uiElementTemplateId())),this.uiElementComponent=M(()=>{let e=this.uiElementTemplate();return!e||!e.config?g(void 0):H(this.#o.getUIElement(e.config.type))}),this.#a=_(()=>{let e=this.uiElementVCR(),t=this.uiElementComponent();if(!e||!t)return null;e.clear();let n=v(this.uiElementTemplateId),s=t.ELEMENT_SYMBOL,p=this.requiredComponentSymbols();if(p.length&&!p.includes(s))return S(`${n}: Wrong element received: expect ${p.map(r=>String(r)).join("or ")} but got ${String(s)}`),null;if(this.uiElementExtraWrapperComponent){let r=e.createComponent(this.uiElementExtraWrapperComponent),E=v(this.uiElementInstance),m=v(this.uiElementTemplate);r.setInput("uiElementInstance",E),r.setInput("uiElementTemplate",m);let c=r.instance.uiElementVCR();if(!c)return null;let i=c.createComponent(t);return r.setInput("uiElementComponentRef",i),i}return e.createComponent(t)}),this.#n=_(()=>{let e=this.uiElementTemplate();if(!e||e.status!=="loaded")return null;let{remoteResourceIds:t,stateSubscription:n}=e.config,s=n?L(this.#t,()=>ge(n)):g(null),p=t?.length?L(this.#t,()=>he(t)):g(null);return T({remoteResourcesStates:p,state:s}).pipe(K({refCount:!0,bufferSize:1}))}),this.#p=_(()=>{let e=this.uiElementTemplate(),t=this.#n();if(e?.status!=="loaded"||!t)return null;let{config:{options:n,remoteResourceIds:s}}=e,p=s?.length?this.#u({elementInterpolationContext$:t}):{isResourceLoading:g(!1),isResourceError:g(!1)},r=this.#c({templateOptions:n,elementInterpolationContext$:t}),E={isLoading:T({isResourceLoading:p.isResourceLoading,isInterpolationLoading:r.isInterpolationLoading}).pipe(h(({isResourceLoading:i,isInterpolationLoading:a})=>i||a)),isError:T({isResourceError:p.isResourceError,isInterpolationError:r.isInterpolationError}).pipe(h(({isResourceError:i,isInterpolationError:a})=>i||a))},m=C(C(C({},p),E),r);return Object.fromEntries(Object.entries(m).map(([i,a])=>[i,a.pipe(Y(Ee),J(500,void 0,{leading:!0,trailing:!0}))]))}),this.isInfinite=_(()=>{let e=this.uiElementTemplateId(),t=this.#s.nativeElement,n=q({ele:t,attrName:"elementTemplateId",attrValue:e});return n&&console.error(`UI element with id ${e} has already existed in parents`),n}),this.uiElementLoadingComponent=d(A,{optional:!0})?.uiElementLoadingComponent,this.uiElementExtraWrapperComponent=d(A,{optional:!0})?.uiElementExtraWrapperComponent,this.#m()}#m(){me(e=>{let t=this.#p(),n=this.#a(),s=this.uiElementTemplate(),p=this.#n();if(!t||!n||s?.status!=="loaded"||!p)return;let r=new D;e(()=>{r.next(),r.complete()});for(let[m,c]of Object.entries(t))this.#l(n.componentType,m)?c.pipe(z(r)).subscribe(i=>{F(`[${this.uiElementTemplateId()}] Input stream for ${m}`),n.setInput(m,i)}):S(`Input ${m} does not exist for component ${n.instance.getElementType()}`);let{eventsHooks:E}=s.config;if(E)for(let[m,c]of Object.entries(E)){let i=n.instance[m];if(!i||!(i instanceof Z))S(`Element ${n.instance.getElementType()} has no support for event "${m}"`);else{let a=p.pipe(Q(1));i.subscribe(R=>{a.pipe(O(u=>this.#e.interpolate({value:c,context:N(C({},u),{$eventOutput:R})}))).subscribe(u=>{F(`Output stream for ${this.uiElementTemplateId()}`),this.#r.triggerActionHooks(u)})})}}})}#l(e,t){let n=le(e)?.inputs;if(!n)throw new Error("Invalid component");return!!n.find(s=>s.propName===t||s.templateName===t)}#c(e){let{templateOptions:t,elementInterpolationContext$:n}=e,s=new y({}),p=s.asObservable().pipe(h(i=>!Object.values(i).every(a=>!a))),r=new y({}),E=r.asObservable().pipe(h(i=>!Object.values(i).every(a=>!a))),m={isInterpolationLoading:p,isInterpolationError:E},c={};for(let[i,a]of Object.entries(t)){let R=this.#e.checkForInterpolation(a);c[i]=R?n.pipe(O(u=>{let f=structuredClone(s.getValue());return f[i]=!0,s.next(f),this.#e.interpolate({context:u,value:a})}),P(u=>{let f=structuredClone(r.getValue());return f[i]=!0,r.next(f),console.warn(`Fail to interpolate ${i}. Error: ${u}`),B}),G({next:()=>{let u=structuredClone(r.getValue());u[i]=!1,r.next(u);let f=structuredClone(s.getValue());f[i]=!1,s.next(f)}})):g(a)}return C(C({},m),c)}#u(e){let{elementInterpolationContext$:t}=e;return{isResourceLoading:t.pipe(h(n=>!!n.remoteResourcesStates?.isPartialLoading.length)),isResourceError:t.pipe(h(n=>!!n.remoteResourcesStates?.isPartialError.length))}}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=oe({type:o,selectors:[["dj-ui-element-wrapper"]],viewQuery:function(t,n){t&1&&ae(n.uiElementVCR,Te,5,W),t&2&&pe()},hostVars:1,hostBindings:function(t,n){t&2&&ie("elementTemplateId",n.uiElementTemplateId())},inputs:{uiElementInstance:[1,"uiElementInstance"],requiredComponentSymbols:[1,"requiredComponentSymbols"]},decls:2,vars:1,consts:[["uiElementVCR",""],[4,"ngIf"],[4,"ngComponentOutlet"]],template:function(t,n){t&1&&I(0,Oe,1,1,"ng-container")(1,Le,2,0,"span"),t&2&&x(n.isInfinite()?1:0)},dependencies:[de,ce,ue],encapsulation:2,changeDetection:0})}}return o})();export{q as a,et as b};
