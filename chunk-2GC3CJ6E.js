import{a as Y,b as w,c as $,d as fe}from"./chunk-4NNSRMKC.js";import{b as le}from"./chunk-VCLEF7AH.js";import{f as ce,i as A,j as J,o as ue,r as pe}from"./chunk-KGG7IXI2.js";import{$ as re,A as V,B as q,Ba as F,Da as se,Gc as ae,Hc as K,Ic as j,Jc as M,N as Z,Oc as z,P as _,S as ee,W as te,Y as ne,Z as ie,a as x,b as H,e as n,f as r,g as o,ia as v,la as oe,lb as L,ma as G,n as Q,nb as U,ob as me,t as X,u as O}from"./chunk-UJ7YJEPZ.js";var P=d=>{let{ele:s,attrName:i,attrValue:m}=d,e=s.parentElement,u=[];for(;e;){let R=e.getAttribute(i);if(R===null){e=e.parentElement;continue}if(u.push(R),R===m)return{contains:!0,chain:u};e=e.parentElement}return{contains:!1,chain:u}};var B=(()=>{var s,i,m,e;let u=class u extends ${constructor(){super(...arguments);r(this,s);r(this,i);r(this,m);r(this,e);o(this,s,v(se)),o(this,i,v(w,{optional:!0})),o(this,m,n(this,i)?.uiElementInfiniteErrorComponent),this.isInfinite=j(()=>{let p=this.uiElementTemplateId(),C=n(this,s).nativeElement,{contains:S,chain:y}=P({ele:C,attrName:"elementTemplateId",attrValue:p});if(S){let he=[...y,p].join(" -> ");console.error(`UI element with id ${p} has already existed in parents. Check ${he}`)}return S}),o(this,e,M(()=>{this.isInfinite()&&n(this,m)&&this.viewContainerRef.createComponent(n(this,m))}))}};s=new WeakMap,i=new WeakMap,m=new WeakMap,e=new WeakMap,u.\u0275fac=(()=>{let p;return function(S){return(p||(p=F(u)))(S||u)}})(),u.\u0275dir=L({type:u,features:[U]});let d=u;return d})();var W=(()=>{var s,i,m;let e=class e extends ${constructor(){super(...arguments);r(this,s);r(this,i);r(this,m);o(this,s,v(w,{optional:!0})),o(this,i,n(this,s)?.uiElementLoadingComponent),this.isLoading=j(()=>this.uiElementTemplate()?.status!=="loaded"),o(this,m,M(()=>{this.isLoading()&&(this.viewContainerRef.clear(),n(this,i)&&this.viewContainerRef.createComponent(n(this,i)))}))}};s=new WeakMap,i=new WeakMap,m=new WeakMap,e.\u0275fac=(()=>{let g;return function(C){return(g||(g=F(e)))(C||e)}})(),e.\u0275dir=L({type:e,features:[U]});let d=e;return d})();var Ye=(()=>{var s,i,m,e,u,R,g,p,C,S;let y=class y extends ${constructor(){super(...arguments);r(this,s);r(this,i);r(this,m);r(this,e);r(this,u);r(this,R);r(this,g);r(this,p);r(this,C);r(this,S);o(this,s,v(fe)),o(this,i,v(oe)),o(this,m,v(pe)),o(this,e,v(B)),o(this,u,v(W)),this.requiredComponentSymbols=z([]),this.configsOverride=z({}),this.uiElementComponent=Y(()=>{let t=this.uiElementTemplate();return!t||!t.config?O(void 0):X(n(this,s).getUIElement(t.config.type))}),o(this,R,j(()=>{if(this.viewContainerRef.clear(),n(this,u).isLoading()||n(this,e).isInfinite())return null;let t=this.uiElementTemplate(),a=this.uiElementComponent(),c=n(this,C).call(this);if(!t||!a||!c)return null;let h=K(this.uiElementTemplateId),l=a.ELEMENT_SYMBOL,b=this.requiredComponentSymbols();if(!this.hasCorrectComponentSymbol(a,b))return A(`${h}: Wrong element received: expect ${b.map(E=>String(E)).join("or ")} but got ${String(l)}`),null;let D,f=this.getUIElementWrapper(l);if(f){f.setInput("uiElementTemplate",t.config);let E=f.instance.uiElementVCR();if(!E)return null;let I=E.createComponent(a);f.setInput("uiElementComponentRef",I),D=I}D=this.viewContainerRef.createComponent(a);for(let[E,I]of Object.entries(c))D.setInput(E,I);return D})),o(this,g,j(()=>{let t=this.uiElementTemplate();if(!t||t.status!=="loaded")return null;let{remoteResourceIds:a,stateSubscription:c}=t.config,h=c?G(n(this,i),()=>ue(c,`UI Element ${t.id}`)):O(null),l=a?.length?G(n(this,i),()=>le(a)):O(null);return q({remoteResourcesStates:l,state:h}).pipe(te({refCount:!0,bufferSize:1}))})),o(this,p,j(()=>{let t=this.uiElementTemplate(),a=n(this,g).call(this);if(t?.status!=="loaded"||!a)return null;let{config:{options:c,remoteResourceIds:h}}=t,l=h?.length?this.generateInputsFromRemoteResource({elementInterpolationContext$:a}):{isResourceLoading:O(!1),isResourceError:O(!1)},b=this.generateInputsWithInterpolationTracking({templateOptions:c,elementInterpolationContext$:a}),D={isLoading:q({isResourceLoading:l.isResourceLoading,isInterpolationLoading:b.isInterpolationLoading}).pipe(V(({isResourceLoading:T,isInterpolationLoading:N})=>!!T||!!N)),isError:q({isResourceError:l.isResourceError,isInterpolationError:b.isInterpolationError}).pipe(V(({isResourceError:T,isInterpolationError:N})=>!!T||!!N))},f=Object.entries(this.configsOverride()).reduce((T,[N,k])=>H(x({},T),{[N]:O(k)}),{}),E=x(x(x(x({},l),D),b),f);return Object.fromEntries(Object.entries(E).map(([T,N])=>[T,N.pipe(_(ce),re(500,void 0,{leading:!0,trailing:!0}))]))})),o(this,C,Y(()=>{let t=n(this,p).call(this),a=this.uiElementComponent();if(!t||!a)return O(void 0);let c=this.getComponentRequiredInputs(a),h={};for(let l of c)h[l]=t[l];return Object.keys(h).length===0?O({}):q(h).pipe(ee())})),o(this,S,M(t=>{let a=n(this,p).call(this),c=n(this,R).call(this),h=this.uiElementTemplate(),l=n(this,g).call(this);if(!a||!c||h?.status!=="loaded"||!l)return;c.location.nativeElement.setAttribute("elementTemplateId",K(this.uiElementTemplateId));let b=new Q;t(()=>{b.next(),b.complete()});for(let[f,E]of Object.entries(a))this.checkInputExistsForComponent(c.componentType,f)?E.pipe(ie(b)).subscribe(I=>{J(`[${this.uiElementTemplateId()}] Input stream for ${f}`),c.setInput(f,I)}):A(`Input ${f} does not exist for component ${c.instance.getElementType()}`);let{eventsHooks:D}=h.config;if(D)for(let[f,E]of Object.entries(D)){let I=c.instance[f];if(!I||!(I instanceof ae))A(`Element ${c.instance.getElementType()} has no support for event "${f}"`);else{let T=l.pipe(Z(1));I.subscribe(N=>{T.pipe(ne(k=>this.interpolationService.interpolate({value:E,context:H(x({},k),{$eventOutput:N})}))).subscribe(k=>{J(`Output stream for ${this.uiElementTemplateId()}`),n(this,m).triggerActionHooks(k)})})}}}))}};s=new WeakMap,i=new WeakMap,m=new WeakMap,e=new WeakMap,u=new WeakMap,R=new WeakMap,g=new WeakMap,p=new WeakMap,C=new WeakMap,S=new WeakMap,y.\u0275fac=(()=>{let t;return function(c){return(t||(t=F(y)))(c||y)}})(),y.\u0275dir=L({type:y,selectors:[["","djuiUIElementRenderer",""]],inputs:{requiredComponentSymbols:[1,"requiredComponentSymbols"],configsOverride:[1,"configsOverride"]},features:[me([{directive:B,inputs:["djuiUIElementRenderer","djuiUIElementRenderer"]},{directive:W,inputs:["djuiUIElementRenderer","djuiUIElementRenderer"]}]),U]});let d=y;return d})();export{Ye as a};
