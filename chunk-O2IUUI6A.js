import{Ac as w,Bc as f,Ca as B,Da as C,Y as R,ca as k,sa as x}from"./chunk-J33AFEAQ.js";import{a as s,b as p}from"./chunk-VKRCUX5N.js";function D(e){let t=w(()=>e());return V(t)?new Proxy(e,{get(n,o){return o in t?(B(n[o])||Object.defineProperty(n,o,{value:f(()=>n()[o]),configurable:!0}),D(n[o])):n[o]}}):e}var L=[WeakSet,WeakMap,Promise,Date,Error,RegExp,ArrayBuffer,DataView,Function];function V(e){if(e===null||typeof e!="object"||_(e))return!1;let t=Object.getPrototypeOf(e);if(t===Object.prototype)return!0;for(;t&&t!==Object.prototype;){if(L.includes(t.constructor))return!1;t=Object.getPrototypeOf(t)}return t===Object.prototype}function _(e){return typeof e?.[Symbol.iterator]=="function"}var z=new WeakMap,u=Symbol("STATE_SOURCE");function d(e,...t){e[u].update(n=>t.reduce((o,i)=>s(s({},o),typeof i=="function"?i(o):i),n)),Q(e)}function G(e){return e[u]()}function J(e){return z.get(e[u])||[]}function Q(e){let t=J(e);for(let n of t){let o=w(()=>G(e));n(o)}}function at(...e){let t=[...e],n=typeof t[0]=="function"?{}:t.shift(),o=t;return(()=>{class r{constructor(){let c=o.reduce((S,U)=>U(S),X()),{stateSignals:y,props:$,methods:F,hooks:H}=c,j=s(s(s({},y),$),F);this[u]=c[u];for(let S of Reflect.ownKeys(j))this[S]=j[S];let{onInit:v,onDestroy:A}=H;v&&v(),A&&k(x).onDestroy(A)}static \u0275fac=function(y){return new(y||r)};static \u0275prov=R({token:r,factory:r.\u0275fac,providedIn:n.providedIn||null})}return r})()}function X(){return{[u]:C({}),stateSignals:{},props:{},methods:{},hooks:{}}}function h(e,...t){let n=typeof e=="function"?[e,...t]:t;return o=>n.reduce((i,r)=>r(i),o)}function Y(e){return t=>{let n=e(s(s(s({[u]:t[u]},t.stateSignals),t.props),t.methods));return Reflect.ownKeys(n),p(s({},t),{props:s(s({},t.props),n)})}}function m(e){return Y(e)}function dt(e){return t=>{let n=s(s(s({[u]:t[u]},t.stateSignals),t.props),t.methods),o=typeof e=="function"?e(n):e,i=r=>{let a=o[r],c=t.hooks[r];return a?()=>{c&&c(),a(n)}:c};return p(s({},t),{hooks:{onInit:i("onInit"),onDestroy:i("onDestroy")}})}}function T(e){return t=>{let n=e(s(s(s({[u]:t[u]},t.stateSignals),t.props),t.methods));return Reflect.ownKeys(n),p(s({},t),{methods:s(s({},t.methods),n)})}}function K(e){return t=>{let n=typeof e=="function"?e():e,o=Reflect.ownKeys(n);t[u].update(r=>s(s({},r),n));let i=o.reduce((r,a)=>{let c=f(()=>t[u]()[a]);return p(s({},r),{[a]:D(c)})},{});return p(s({},t),{stateSignals:s(s({},t.stateSignals),i)})}}var l=function(e){return e[e.None=0]="None",e[e.Entities=1]="Entities",e[e.Both=2]="Both",e}(l||{}),Z=e=>e.id;function W(e){return e?.selectId??Z}function b(e){let t=e?.collection,n=t===void 0?"entityMap":`${t}EntityMap`,o=t===void 0?"ids":`${t}Ids`,i=t===void 0?"entities":`${t}Entities`;return{entityMapKey:n,idsKey:o,entitiesKey:i}}function tt(e,t){return{entityMap:s({},e[t.entityMapKey]),ids:[...e[t.idsKey]]}}function et(e,t,n){switch(n){case l.Both:return{[t.entityMapKey]:e.entityMap,[t.idsKey]:e.ids};case l.Entities:return{[t.entityMapKey]:e.entityMap};default:return{}}}function N(e,t,n){let o=n(t);return e.entityMap[o]?(e.entityMap[o]=t,l.Entities):(e.entityMap[o]=t,e.ids.push(o),l.Both)}function nt(e,t,n){let o=l.None;for(let i of t){let r=N(e,i,n);o!==l.Both&&(o=r)}return o}function I(e,t){let n=W(t),o=b(t);return i=>{let r=tt(i,o),a=N(r,e,n);return et(r,o,a)}}function P(e,t){let n=W(t),o=b(t);return()=>{let i={entityMap:{},ids:[]};return nt(i,e,n),{[o.entityMapKey]:i.entityMap,[o.idsKey]:i.ids}}}function q(e){let{entityMapKey:t,idsKey:n,entitiesKey:o}=b(e);return h(K({[t]:{},[n]:[]}),m(i=>({[o]:f(()=>{let r=i[t]();return i[n]().map(c=>r[c])})})))}var M=()=>({requestStatus:"pending"}),g=()=>({requestStatus:"fulfilled"}),E=e=>({requestStatus:{error:e}}),O=()=>h(K({requestStatus:"idle"}),m(({requestStatus:e})=>({isPending:f(()=>e()==="pending"),isFulfilled:f(()=>e()==="fulfilled"),error:f(()=>{let t=e();return typeof t=="object"?t.error:null})})));var bt=e=>h(q(),O(),T(t=>{let n=e();return{loadAll:async()=>{if(!n.fetchAll)throw Error("fetchAll loader was not provided");d(t,M());try{let i=await n.fetchAll();return d(t,P(i),g()),i}catch(i){throw E("Something went wrong fetching all entities"),i}},get:async i=>{let a=w(t.entities).find(c=>c.id===i);if(a)return a;if(!n.fetch)throw Error("fetch loader was not provided");d(t,M());try{let c=await n.fetch(i);return d(t,I(c),g()),c}catch(c){let y=`Something went wrong fetching entity with id ${i}. Err: ${c}`;throw E(y),d(t,g()),Error(y)}},add:async i=>{if(!n.create)throw Error("create loader was not provided");d(t,M());try{let r=await n.create(i);return d(t,I(r),g()),r}catch(r){throw E("Something went wrong creating entity"),r}},change:async i=>{if(!n.update)throw Error("update loader was not provided");d(t,M());try{let r=await n.update(i);return d(t,I(r),g()),r}catch(r){throw E("Something went wrong updating entity"),r}}}}));export{d as a,at as b,m as c,dt as d,T as e,K as f,bt as g};
