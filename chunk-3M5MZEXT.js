import{b as Te}from"./chunk-EL742H5C.js";import{f as Ie,h as be,k as Y,l as J,n as Ce,q as ve,v as Se}from"./chunk-XDSASVCN.js";import{$ as le,A as N,B as q,Da as de,Gc as he,Hc as X,Ic as A,J as ne,Jc as B,N as oe,Oc as H,P as re,W as ie,Xc as ge,Y as K,Z as se,_ as ae,a as R,b as V,da as me,e,f as s,fb as fe,g as f,ga as pe,h as U,ia as y,la as ce,lb as Ee,ma as z,n as _,o as G,r as ee,t as te,u as x,wa as ue}from"./chunk-UJ7YJEPZ.js";var Q=v=>{let u=ue(void 0);return B(E=>{let h=v().subscribe(r=>u.set(r));E(()=>{h.unsubscribe()})}),u};var Z=v=>{let{ele:u,attrName:E,attrValue:a}=v,h=u.parentElement,r=[];for(;h;){let l=h.getAttribute(E);if(l===null){h=h.parentElement;continue}if(r.push(l),l===a)return{contains:!0,chain:r};h=h.parentElement}return{contains:!1,chain:r}};var Re=(()=>{var u,E;let a=class a{constructor(){s(this,u,{});s(this,E,{})}registerUIElement(r){let{type:l,component:d}=r;e(this,u)[l]=d}registerUIElementLoader(r){let{type:l,loader:d}=r;e(this,E)[l]=d}getUIElement(r){let l=e(this,u)[r];if(!l){let d=e(this,E)[r];if(d)return d();throw new Error(`${r} has not been registered as a UI Element yet!`)}return Promise.resolve(l)}};u=new WeakMap,E=new WeakMap,a.\u0275fac=function(l){return new(l||a)},a.\u0275prov=me({token:a,factory:a.\u0275fac,providedIn:"root"});let v=a;return v})();var Ne=new pe("ELEMENT_RENDERER_CONFIG"),ot=(()=>{var u,E,a,h,r,l,d,M,$,D,j,F,k,W,P,b,ye,Le,Oe,xe,Me;let w=class w{constructor(){s(this,b);s(this,u);s(this,E);s(this,a);s(this,h);s(this,r);s(this,l);s(this,d);s(this,M);s(this,$);s(this,D);s(this,j);s(this,F);s(this,k);s(this,W);s(this,P);f(this,u,y(Re)),f(this,E,y(Se)),f(this,a,y(Ce)),f(this,h,y(ce)),f(this,r,y(be)),f(this,l,y(de)),f(this,d,y(fe)),f(this,M,y(Ne,{optional:!0})),f(this,$,e(this,M)?.uiElementLoadingComponent),f(this,D,e(this,M)?.uiElementInfiniteErrorComponent),f(this,j,e(this,M)?.uiElementWrapperComponent),this.uiElementTemplateId=H.required({alias:"djuiUIElementRenderer"}),this.requiredComponentSymbols=H([]),this.configsOverride=H({}),this.uiElementTemplate=Q(()=>e(this,E).getTemplate(this.uiElementTemplateId())),this.uiElementComponent=Q(()=>{let n=this.uiElementTemplate();return!n||!n.config?x(void 0):te(e(this,u).getUIElement(n.config.type))}),f(this,F,A(()=>{e(this,d).clear();let n=this.uiElementTemplate();if(n?.status!=="loaded")return e(this,$)&&e(this,d).createComponent(e(this,$)),null;if(this.isInfinite())return e(this,D)&&e(this,d).createComponent(e(this,D)),null;let t=this.uiElementComponent();if(!t)return null;let o=X(this.uiElementTemplateId),i=t.ELEMENT_SYMBOL,g=this.requiredComponentSymbols();if(!U(this,b,xe).call(this,t,g))return Y(`${o}: Wrong element received: expect ${g.map(T=>String(T)).join("or ")} but got ${String(i)}`),null;let m=U(this,b,Me).call(this,i);if(m){m.setInput("uiElementTemplate",n.config);let T=m.instance.uiElementVCR();if(!T)return null;let I=T.createComponent(t);return m.setInput("uiElementComponentRef",I),I}return e(this,d).createComponent(t)})),f(this,k,A(()=>{let n=this.uiElementTemplate();if(!n||n.status!=="loaded")return null;let{remoteResourceIds:t,stateSubscription:o}=n.config,i=o?z(e(this,h),()=>ve(o,`UI Element ${n.id}`)):x(null),g=t?.length?z(e(this,h),()=>Te(t)):x(null);return q({remoteResourcesStates:g,state:i}).pipe(ie({refCount:!0,bufferSize:1}))})),f(this,W,A(()=>{let n=this.uiElementTemplate(),t=e(this,k).call(this);if(n?.status!=="loaded"||!t)return null;let{config:{options:o,remoteResourceIds:i}}=n,g=i?.length?U(this,b,Oe).call(this,{elementInterpolationContext$:t}):{isResourceLoading:x(!1),isResourceError:x(!1)},m=U(this,b,Le).call(this,{templateOptions:o,elementInterpolationContext$:t}),T={isLoading:q({isResourceLoading:g.isResourceLoading,isInterpolationLoading:m.isInterpolationLoading}).pipe(N(({isResourceLoading:c,isInterpolationLoading:S})=>c||S)),isError:q({isResourceError:g.isResourceError,isInterpolationError:m.isInterpolationError}).pipe(N(({isResourceError:c,isInterpolationError:S})=>c||S))},I=Object.entries(this.configsOverride()).reduce((c,[S,C])=>V(R({},c),{[S]:x(C)}),{}),L=R(R(R(R({},g),T),m),I);return Object.fromEntries(Object.entries(L).map(([c,S])=>[c,S.pipe(re(Ie),le(500,void 0,{leading:!0,trailing:!0}))]))})),this.isInfinite=A(()=>{let n=this.uiElementTemplateId(),t=e(this,l).nativeElement,{contains:o,chain:i}=Z({ele:t,attrName:"elementTemplateId",attrValue:n});if(o){let g=[...i,n].join(" -> ");console.error(`UI element with id ${n} has already existed in parents. Check ${g}`)}return o}),f(this,P,B(n=>{let t=e(this,W).call(this),o=e(this,F).call(this),i=this.uiElementTemplate(),g=e(this,k).call(this);if(!t||!o||i?.status!=="loaded"||!g)return;o.location.nativeElement.setAttribute("elementTemplateId",X(this.uiElementTemplateId));let m=new _;n(()=>{m.next(),m.complete()});for(let[I,L]of Object.entries(t))U(this,b,ye).call(this,o.componentType,I)?L.pipe(se(m)).subscribe(p=>{J(`[${this.uiElementTemplateId()}] Input stream for ${I}`),o.setInput(I,p)}):Y(`Input ${I} does not exist for component ${o.instance.getElementType()}`);let{eventsHooks:T}=i.config;if(T)for(let[I,L]of Object.entries(T)){let p=o.instance[I];if(!p||!(p instanceof he))Y(`Element ${o.instance.getElementType()} has no support for event "${I}"`);else{let c=g.pipe(oe(1));p.subscribe(S=>{c.pipe(K(C=>e(this,a).interpolate({value:L,context:V(R({},C),{$eventOutput:S})}))).subscribe(C=>{J(`Output stream for ${this.uiElementTemplateId()}`),e(this,r).triggerActionHooks(C)})})}}}))}};u=new WeakMap,E=new WeakMap,a=new WeakMap,h=new WeakMap,r=new WeakMap,l=new WeakMap,d=new WeakMap,M=new WeakMap,$=new WeakMap,D=new WeakMap,j=new WeakMap,F=new WeakMap,k=new WeakMap,W=new WeakMap,P=new WeakMap,b=new WeakSet,ye=function(n,t){let o=ge(n)?.inputs;if(!o)throw new Error("Invalid component");return!!o.find(i=>i.propName===t||i.templateName===t)},Le=function(n){let{templateOptions:t,elementInterpolationContext$:o}=n,i=new G({}),g=i.asObservable().pipe(N(p=>!Object.values(p).every(c=>!c))),m=new G({}),T=m.asObservable().pipe(N(p=>!Object.values(p).every(c=>!c))),I={isInterpolationLoading:g,isInterpolationError:T},L={};for(let[p,c]of Object.entries(t)){let S=e(this,a).checkForInterpolation(c);L[p]=S?o.pipe(K(C=>{let O=structuredClone(i.getValue());return O[p]=!0,i.next(O),e(this,a).interpolate({context:C,value:c})}),ne(C=>{let O=structuredClone(m.getValue());return O[p]=!0,m.next(O),console.warn(`Fail to interpolate ${p}. Error: ${C}`),ee}),ae({next:()=>{let C=structuredClone(m.getValue());C[p]=!1,m.next(C);let O=structuredClone(i.getValue());O[p]=!1,i.next(O)}})):x(c)}return R(R({},I),L)},Oe=function(n){let{elementInterpolationContext$:t}=n;return{isResourceLoading:t.pipe(N(o=>!!o.remoteResourcesStates?.isPartialLoading.length)),isResourceError:t.pipe(N(o=>!!o.remoteResourcesStates?.isPartialError.length))}},xe=function(n,t){let o=n.ELEMENT_SYMBOL;return!(t.length&&!t.includes(o))},Me=function(n){if(!e(this,j))return null;let t=e(this,j).EXCLUDED_ELEMENTS;return t&&!t.has(n)?e(this,d).createComponent(e(this,j)):null},w.\u0275fac=function(t){return new(t||w)},w.\u0275dir=Ee({type:w,selectors:[["","djuiUIElementRenderer",""]],inputs:{uiElementTemplateId:[1,"djuiUIElementRenderer","uiElementTemplateId"],requiredComponentSymbols:[1,"requiredComponentSymbols"],configsOverride:[1,"configsOverride"]}});let v=w;return v})();export{Re as a,Ne as b,ot as c};
