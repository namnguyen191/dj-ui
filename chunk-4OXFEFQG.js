import{a as Ie,b as ve,c as Pe,d as Oe,e as be}from"./chunk-AXTAIUVK.js";import{a as Z,b as te}from"./chunk-W2FLMXPC.js";import{a as I}from"./chunk-YSZCCSLN.js";import{a as _e}from"./chunk-NHVOUDX7.js";import{a as K,b as X}from"./chunk-OEMD7ULJ.js";import{a as le,b as de}from"./chunk-K4CJI7RR.js";import{a as Te,b as Se,c as Me,d as Ce,e as ye,f as we}from"./chunk-AVQT7YHK.js";import{a as me,b as pe,c as ce,d as ue,e as ge,f as fe,g as Ee,h as he}from"./chunk-53RS7JFF.js";import"./chunk-444XMBZH.js";import{a as $}from"./chunk-LLLXTKEK.js";import{c as se}from"./chunk-BXRE4WUR.js";import"./chunk-G3BAUKRR.js";import"./chunk-JRTCKBMB.js";import"./chunk-WEDA6QA5.js";import{D as w,p as re,t as ae}from"./chunk-IMW6CZRX.js";import{b as C,e as y}from"./chunk-OODSUOXW.js";import{d as G,f as Q}from"./chunk-HOXVOTVY.js";import{a as ie,b as oe,c as ne}from"./chunk-F3GE6OJC.js";import"./chunk-ZOQKNKYY.js";import"./chunk-JDKJRDVM.js";import"./chunk-BUINW6WJ.js";import{m as ee}from"./chunk-IABOC2ZU.js";import"./chunk-TV56DAVP.js";import{$a as d,$c as q,Cb as s,Cc as V,Ec as E,F as j,Fc as M,Hb as x,Mb as l,Nb as m,Ob as f,Sb as U,Tb as p,Ub as L,V as O,Vc as z,da as a,dc as u,f as D,hb as b,jc as J,kc as W,lc as Y,ma as h,mb as S,na as _,oa as k,pa as B,qb as H,r as F,tb as R}from"./chunk-RVPXDSFJ.js";import{a as g,b as T,c as A}from"./chunk-Q7L6LLAK.js";var N="UI_ELEMENT_TEMPLATE_FOR_PREVIEW_ONLY",v={id:"preview-layout",gridConfigs:{compactType:Z.None},uiElementInstances:[]},xe={currentEditingTemplate:null},P=Se({providedIn:"root"},we(xe),Me(({currentEditingTemplate:t})=>({currentEditableFields:V(()=>{let r=t();if(!r)return null;let c=r,{id:e,createdAt:i,updatedAt:o}=c;return A(c,["id","createdAt","updatedAt"])}),currentUnEditableFields:V(()=>{let r=t();if(!r)return null;let{id:e,createdAt:i,updatedAt:o}=r;return{id:e,createdAt:i,updatedAt:o}})})),ye((t,r=a(ee),e=a($))=>({setCurrentEditingTemplate:i=>{r.updateOrRegisterTemplate(T(g({},i),{id:N})),e.updateTemplate(T(g({},v),{uiElementInstances:[{id:"instance-1",uiElementTemplateId:N}]})),Te(t,{currentEditingTemplate:i})},updateCurrentEditingTemplate:i=>{r.updateTemplate(T(g({},i),{id:N})),ve(t,o=>{let n=E(t.currentUnEditableFields);!o.currentEditingTemplate||!n||(o.currentEditingTemplate=g(g({},n),i))})},initPreviewLayout:()=>{e.registerTemplate(v)}})),Ce({onInit:({initPreviewLayout:t})=>{t()}}));function Ve(t,r){t&1&&f(0,"cds-loading",5),t&2&&s("isActive",!0)}function Ne(t,r){if(t&1){let e=U();l(0,"ngx-monaco-editor",9),p("ngModelChange",function(o){h(e);let n=L();return _(n.codeChangeSubject.next(o))}),m()}if(t&2){let e=L(),i=Y(1);s("ngModel",i)("options",e.editorOptions)}}function Ae(t,r){t&1&&u(0," Error in JSON ")}function De(t,r){t&1&&u(0," Save your changes ")}function Fe(t,r){t&1&&f(0,"cds-loading",10)}var Re=(()=>{class t extends me{#e;#t;#i;constructor(){super(),this.#e=a(I),this.#t=a(P),this.loadingSig=this.#e.isPending,this.codeChangeSubject=new D,this.editorOptions={theme:"vs-dark",language:"json",wordWrap:"on"},this.codeSig=b(""),this.errorStateSig=b("noError"),this.#i="",this.codeChangeSubject.pipe(O({next:()=>this.errorStateSig.set("isPending")}),j(500),O({next:e=>{this.codeSig.set(e),this.#r(e)?this.errorStateSig.set("noError"):this.errorStateSig.set("isError")}}),K()).subscribe(),this.#o()}async updateUIElementTemplate(){let e=JSON.parse(E(this.codeSig));this.#t.updateCurrentEditingTemplate(e);let i=E(this.#t.currentEditingTemplate);if(!i){console.error("Edited template is missing from store");return}await this.#e.change(i),E(this.#e.error)||this.closeModal()}#o(){M(async()=>{let e=this.#t.currentEditableFields();if(!e)return;let i=JSON.stringify(e),o=await this.#n(i);this.#i=o,this.codeSig.set(o)})}async#n(e){return await be(e,{parser:"json",plugins:[Pe,Oe]})}#r(e){try{return JSON.parse(e),!0}catch(i){return console.log("Something went wrong:",i),!1}}closeModal(){this.codeSig.set(this.#i),super.closeModal()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=S({type:t,selectors:[["namnguyen191-raw-template-editor-modal"]],features:[H],decls:16,vars:7,consts:[["size","lg",3,"overlaySelected","open"],[3,"closeSelect","showCloseButton"],["cdsModalHeaderLabel",""],["cdsModalHeaderHeading",""],["cdsModalContent","",1,"modal-body"],[3,"isActive"],[1,"editor-container",3,"ngModel","options"],["cdsButton","primary",3,"click","disabled"],["size","sm",4,"ngIf"],[1,"editor-container",3,"ngModelChange","ngModel","options"],["size","sm"]],template:function(i,o){if(i&1){let n=U();J(0)(1),l(2,"cds-modal",0),p("overlaySelected",function(){return h(n),_(o.closeModal())}),l(3,"cds-modal-header",1),p("closeSelect",function(){return h(n),_(o.closeModal())}),l(4,"h2",2),u(5,"Editor"),m(),l(6,"h3",3),u(7,"Edit your template in JSON"),m()(),l(8,"section",4),R(9,Ve,1,1,"cds-loading",5)(10,Ne,1,2,"ngx-monaco-editor",6),m(),l(11,"cds-modal-footer")(12,"button",7),p("click",function(){return h(n),_(o.updateUIElementTemplate())}),R(13,Ae,1,0)(14,De,1,0)(15,Fe,1,0,"cds-loading",8),m()()()}if(i&2){let n=o.errorStateSig();d();let c=W(o.codeSig());d(),s("open",o.open),d(),s("showCloseButton",!0),d(6),x(o.loadingSig()||!c?9:10),d(3),s("disabled",n==="isError"||n==="isPending"),d(),x(n==="isError"?13:14),d(2),s("ngIf",n==="isPending")}},dependencies:[q,z,he,pe,ce,ue,ge,fe,Ee,_e,w,re,ae,de,le,y,C,se],styles:["[_nghost-%COMP%]{display:contents}[_nghost-%COMP%]   .modal-body[_ngcontent-%COMP%]{height:70vh;display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .modal-body[_ngcontent-%COMP%]   .editor-container[_ngcontent-%COMP%]{height:100%;flex:1}"],changeDetection:0})}}return t})();var Mt=(()=>{class t{#e;#t;#i;#o;#n;#r;#a;constructor(){this.#e=a(G),this.#t=a(Q),this.#i=a(I),this.#o=a(P),this.#n=a(ie),this.#r=this.#e.snapshot.params.id,this.#a="editRawTemplate",this.isRawTemplateEditorModalOpenSig=X(this.#e.queryParams.pipe(F(e=>e[this.#a]==="true")),{initialValue:!1}),this.PREVIEW_LAYOUT_ID=v.id,this.#n.registerAll([Ie]),this.#i.updateQuery({id:this.#r}),this.#l()}toggleModal(e){this.#t.navigate([],{relativeTo:this.#e,queryParams:{[this.#a]:e?!0:null},queryParamsHandling:"merge"})}#l(){M(()=>{let e=this.#i.filteredUIElementTemplates()[0];e&&this.#o.setCurrentEditingTemplate(e)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=S({type:t,selectors:[["namnguyen191-edit-ui-element-template-page"]],decls:6,vars:2,consts:[[3,"layoutId"],[1,"edit-controls-container"],["cdsButton","primary",3,"click"],["cdsIcon","edit","size","16",1,"cds--btn__icon"],[3,"close","open"]],template:function(i,o){i&1&&(f(0,"djui",0),l(1,"div",1)(2,"button",2),p("click",function(){return o.toggleModal(!0)}),u(3," Open template editor "),k(),f(4,"svg",3),m()(),B(),l(5,"namnguyen191-raw-template-editor-modal",4),p("close",function(){return o.toggleModal(!1)}),m()),i&2&&(s("layoutId",o.PREVIEW_LAYOUT_ID),d(5),s("open",o.isRawTemplateEditorModalOpenSig()))},dependencies:[te,w,y,C,ne,oe,Re],styles:["[_nghost-%COMP%]{height:calc(100vh - 3rem);display:grid;grid-template-columns:minmax(0,1fr) 20rem}[_nghost-%COMP%]   .edit-controls-container[_ngcontent-%COMP%]{display:flex;align-items:baseline}[_nghost-%COMP%]   .edit-controls-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex-grow:1}[_nghost-%COMP%]     gridster-item{background-color:#0003}"],changeDetection:0})}}return t})();export{Mt as EditUIElementTemplatePageComponent};
