import{a as Pe,b as ve,c as Oe,d as be,e as xe}from"./chunk-AXTAIUVK.js";import{a as $,b as ie}from"./chunk-HGQGSJNP.js";import{a as I}from"./chunk-PCRFHJQV.js";import{a as Te}from"./chunk-NHVOUDX7.js";import{a as X,b as Z}from"./chunk-OEMD7ULJ.js";import{a as de,b as se}from"./chunk-K4CJI7RR.js";import{a as Ce,b as Me,c as Se,d as ye,e as we,f as Ie}from"./chunk-AVQT7YHK.js";import{a as pe,b as ce,c as ue,d as ge,e as _e,f as fe,g as Ee,h as he}from"./chunk-53RS7JFF.js";import"./chunk-3TXQWQWL.js";import{a as ee}from"./chunk-RFM5HJJR.js";import{c as me}from"./chunk-BXRE4WUR.js";import"./chunk-G3BAUKRR.js";import"./chunk-JRTCKBMB.js";import"./chunk-WEDA6QA5.js";import{D as w,p as ae,t as le}from"./chunk-IMW6CZRX.js";import{b as S,e as y}from"./chunk-OODSUOXW.js";import{d as Q,f as K}from"./chunk-HOXVOTVY.js";import{a as oe,b as ne,c as re}from"./chunk-F3GE6OJC.js";import"./chunk-ST6LUG46.js";import"./chunk-AC577EVM.js";import{a as te}from"./chunk-FQHWX7XN.js";import"./chunk-ROZW5JAP.js";import"./chunk-LMQLNWY7.js";import"./chunk-I7O7BTAO.js";import{$a as s,$c as G,Cb as d,Cc as U,Ec as V,F,Fc as M,Hb as x,Mb as l,Nb as m,Ob as f,Sb as R,Tb as p,Ub as C,V as O,Vc as q,da as a,dc as c,f as A,gc as W,hb as k,hc as J,ic as Y,jc as z,ma as g,mb as T,na as _,oa as B,pa as j,qb as H,r as D,tb as b}from"./chunk-RVPXDSFJ.js";import{a as u,b as h,c as N}from"./chunk-Q7L6LLAK.js";var L="UI_ELEMENT_TEMPLATE_FOR_PREVIEW_ONLY",P={id:"preview-layout",gridConfigs:{compactType:$.None},uiElementInstances:[]},Ue={currentEditingTemplate:null},v=Me({providedIn:"root"},Ie(Ue),Se(({currentEditingTemplate:t})=>({currentEditableFields:U(()=>{let r=t();if(!r)return null;let E=r,{id:e,createdAt:i,updatedAt:o}=E;return N(E,["id","createdAt","updatedAt"])}),currentUnEditableFields:U(()=>{let r=t();if(!r)return null;let{id:e,createdAt:i,updatedAt:o}=r;return{id:e,createdAt:i,updatedAt:o}})})),we((t,r=a(te),e=a(ee))=>({setCurrentEditingTemplate:i=>{r.updateOrRegisterTemplate(h(u({},i),{id:L})),e.updateTemplate(h(u({},P),{uiElementInstances:[{id:"instance-1",uiElementTemplateId:L}]})),Ce(t,{currentEditingTemplate:i})},updateCurrentEditingTemplate:i=>{r.updateTemplate(h(u({},i),{id:L})),ve(t,o=>{o.currentEditingTemplate&&(o.currentEditingTemplate=u(u({},o.currentEditingTemplate),i))})},initPreviewLayout:()=>{e.registerTemplate(P)}})),ye({onInit:({initPreviewLayout:t})=>{t()}}));function Ne(t,r){t&1&&f(0,"cds-loading",5),t&2&&d("isActive",!0)}function Ae(t,r){if(t&1){let e=R();l(0,"ngx-monaco-editor",9),Y("ngModelChange",function(o){g(e);let n=C();return J(n.code,o)||(n.code=o),_(o)}),p("ngModelChange",function(o){g(e);let n=C();return _(n.codeChangeSubject.next(o))}),m()}if(t&2){let e=C();d("options",e.editorOptions),W("ngModel",e.code)}}function De(t,r){t&1&&c(0," Error in JSON ")}function Fe(t,r){t&1&&c(0," Save your changes ")}function Be(t,r){t&1&&f(0,"cds-loading",10)}var Re=(()=>{class t extends pe{#e;#t;#i;constructor(){super(),this.#e=a(I),this.#t=a(v),this.loadingSig=this.#e.isPending,this.codeChangeSubject=new A,this.editorOptions={theme:"vs-dark",language:"json",wordWrap:"on"},this.code="",this.errorStateSig=k("noError"),this.#i="",this.codeChangeSubject.pipe(O({next:()=>this.errorStateSig.set("isPending")}),F(500),O({next:e=>{this.#r(e)?this.errorStateSig.set("noError"):this.errorStateSig.set("isError")}}),X()).subscribe(),this.#o()}async updateUIElementTemplate(){let e=JSON.parse(this.code);this.#t.updateCurrentEditingTemplate(e);let i=V(this.#t.currentEditingTemplate);if(!i){console.error("Edited template is missing from store");return}await this.#e.change(i),V(this.#e.error)||this.closeModal()}#o(){M(async()=>{let e=this.#t.currentEditableFields();if(!e)return;let i=JSON.stringify(e),o=await this.#n(i);this.code=this.#i=o})}async#n(e){return await xe(e,{parser:"json",plugins:[Oe,be]})}#r(e){try{return JSON.parse(e),!0}catch(i){return console.log("Something went wrong:",i),!1}}closeModal(){this.code=this.#i,super.closeModal()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=T({type:t,selectors:[["namnguyen191-raw-template-editor-modal"]],features:[H],decls:15,vars:6,consts:[["size","lg",3,"overlaySelected","open"],[3,"closeSelect","showCloseButton"],["cdsModalHeaderLabel",""],["cdsModalHeaderHeading",""],["cdsModalContent","",1,"modal-body"],[3,"isActive"],[1,"editor-container",3,"options","ngModel"],["cdsButton","primary",3,"click","disabled"],["size","sm",4,"ngIf"],[1,"editor-container",3,"ngModelChange","options","ngModel"],["size","sm"]],template:function(i,o){if(i&1){let n=R();z(0),l(1,"cds-modal",0),p("overlaySelected",function(){return g(n),_(o.closeModal())}),l(2,"cds-modal-header",1),p("closeSelect",function(){return g(n),_(o.closeModal())}),l(3,"h2",2),c(4,"Editor"),m(),l(5,"h3",3),c(6,"Edit your template in JSON"),m()(),l(7,"section",4),b(8,Ne,1,1,"cds-loading",5)(9,Ae,1,2,"ngx-monaco-editor",6),m(),l(10,"cds-modal-footer")(11,"button",7),p("click",function(){return g(n),_(o.updateUIElementTemplate())}),b(12,De,1,0)(13,Fe,1,0)(14,Be,1,0,"cds-loading",8),m()()()}if(i&2){let n=o.errorStateSig();s(),d("open",o.open),s(),d("showCloseButton",!0),s(6),x(o.loadingSig()||!o.code?8:9),s(3),d("disabled",n==="isError"||n==="isPending"),s(),x(n==="isError"?12:13),s(2),d("ngIf",n==="isPending")}},dependencies:[G,q,he,ce,ue,ge,_e,fe,Ee,Te,w,ae,le,se,de,y,S,me],styles:["[_nghost-%COMP%]{display:contents}[_nghost-%COMP%]   .modal-body[_ngcontent-%COMP%]{height:70vh;display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .modal-body[_ngcontent-%COMP%]   .editor-container[_ngcontent-%COMP%]{height:100%;flex:1}"],changeDetection:0})}}return t})();var St=(()=>{class t{#e;#t;#i;#o;#n;#r;#a;constructor(){this.#e=a(Q),this.#t=a(K),this.#i=a(I),this.#o=a(v),this.#n=a(oe),this.#r=this.#e.snapshot.params.id,this.#a="editRawTemplate",this.isRawTemplateEditorModalOpenSig=Z(this.#e.queryParams.pipe(D(e=>e[this.#a]==="true")),{initialValue:!1}),this.PREVIEW_LAYOUT_ID=P.id,this.#n.registerAll([Pe]),this.#i.updateQuery({id:this.#r}),this.#l()}toggleModal(e){this.#t.navigate([],{relativeTo:this.#e,queryParams:{[this.#a]:e?!0:null},queryParamsHandling:"merge"})}#l(){M(()=>{let e=this.#i.filteredUIElementTemplates()[0];e&&this.#o.setCurrentEditingTemplate(e)})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=T({type:t,selectors:[["namnguyen191-edit-ui-element-template-page"]],decls:6,vars:2,consts:[[3,"layoutId"],[1,"edit-controls-container"],["cdsButton","primary",3,"click"],["cdsIcon","edit","size","16",1,"cds--btn__icon"],[3,"close","open"]],template:function(i,o){i&1&&(f(0,"djui",0),l(1,"div",1)(2,"button",2),p("click",function(){return o.toggleModal(!0)}),c(3," Open template editor "),B(),f(4,"svg",3),m()(),j(),l(5,"namnguyen191-raw-template-editor-modal",4),p("close",function(){return o.toggleModal(!1)}),m()),i&2&&(d("layoutId",o.PREVIEW_LAYOUT_ID),s(5),d("open",o.isRawTemplateEditorModalOpenSig()))},dependencies:[ie,w,y,S,re,ne,Re],styles:["[_nghost-%COMP%]{height:calc(100vh - 3rem);display:grid;grid-template-columns:minmax(0,1fr) 20rem}[_nghost-%COMP%]   .edit-controls-container[_ngcontent-%COMP%]{display:flex;align-items:baseline}[_nghost-%COMP%]   .edit-controls-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex-grow:1}[_nghost-%COMP%]     gridster-item{background-color:#0003}"],changeDetection:0})}}return t})();export{St as EditUIElementTemplatePageComponent};
