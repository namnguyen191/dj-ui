import{Cc as f,Ec as E,Z as A,da as O,gb as R,hb as B,ta as x}from"./chunk-RVPXDSFJ.js";import{a as s,b as p}from"./chunk-Q7L6LLAK.js";function D(e){let t=E(()=>e());return L(t)?new Proxy(e,{get(n,o){return o in t?(R(n[o])||Object.defineProperty(n,o,{value:f(()=>n()[o]),configurable:!0}),D(n[o])):n[o]}}):e}var U=[WeakSet,WeakMap,Promise,Date,Error,RegExp,ArrayBuffer,DataView,Function];function L(e){if(e===null||typeof e!="object"||V(e))return!1;let t=Object.getPrototypeOf(e);if(t===Object.prototype)return!0;for(;t&&t!==Object.prototype;){if(U.includes(t.constructor))return!1;t=Object.getPrototypeOf(t)}return t===Object.prototype}function V(e){return typeof e?.[Symbol.iterator]=="function"}var _=new WeakMap,u=Symbol("STATE_SOURCE");function d(e,...t){e[u].update(n=>t.reduce((o,i)=>s(s({},o),typeof i=="function"?i(o):i),n)),Q(e)}function G(e){return e[u]()}function J(e){return _.get(e[u])||[]}function Q(e){let t=J(e);for(let n of t){let o=E(()=>G(e));n(o)}}function at(...e){let t=[...e],n=typeof t[0]=="function"?{}:t.shift(),o=t;return(()=>{class r{constructor(){let c=o.reduce((m,H)=>H(m),X()),{stateSignals:y,props:q,methods:z,hooks:$}=c,K=s(s(s({},y),q),z);this[u]=c[u];for(let m in K)this[m]=K[m];let{onInit:v,onDestroy:k}=$;v&&v(),k&&O(x).onDestroy(k)}static \u0275fac=function(y){return new(y||r)};static \u0275prov=A({token:r,factory:r.\u0275fac,providedIn:n.providedIn||null})}return r})()}function X(){return{[u]:B({}),stateSignals:{},props:{},methods:{},hooks:{}}}function h(e,...t){let n=typeof e=="function"?[e,...t]:t;return o=>n.reduce((i,r)=>r(i),o)}function Y(e){return t=>{let n=e(s(s(s({[u]:t[u]},t.stateSignals),t.props),t.methods));return Object.keys(n),p(s({},t),{props:s(s({},t.props),n)})}}function S(e){return Y(e)}function dt(e){return t=>{let n=s(s(s({[u]:t[u]},t.stateSignals),t.props),t.methods),o=typeof e=="function"?e(n):e,i=r=>{let a=o[r],c=t.hooks[r];return a?()=>{c&&c(),a(n)}:c};return p(s({},t),{hooks:{onInit:i("onInit"),onDestroy:i("onDestroy")}})}}function C(e){return t=>{let n=e(s(s(s({[u]:t[u]},t.stateSignals),t.props),t.methods));return Object.keys(n),p(s({},t),{methods:s(s({},t.methods),n)})}}function b(e){return t=>{let n=typeof e=="function"?e():e,o=Object.keys(n);t[u].update(r=>s(s({},r),n));let i=o.reduce((r,a)=>{let c=f(()=>t[u]()[a]);return p(s({},r),{[a]:D(c)})},{});return p(s({},t),{stateSignals:s(s({},t.stateSignals),i)})}}var l=function(e){return e[e.None=0]="None",e[e.Entities=1]="Entities",e[e.Both=2]="Both",e}(l||{}),Z=e=>e.id;function P(e){return e?.selectId??Z}function I(e){let t=e?.collection,n=t===void 0?"entityMap":`${t}EntityMap`,o=t===void 0?"ids":`${t}Ids`,i=t===void 0?"entities":`${t}Entities`;return{entityMapKey:n,idsKey:o,entitiesKey:i}}function tt(e,t){return{entityMap:s({},e[t.entityMapKey]),ids:[...e[t.idsKey]]}}function et(e,t,n){switch(n){case l.Both:return{[t.entityMapKey]:e.entityMap,[t.idsKey]:e.ids};case l.Entities:return{[t.entityMapKey]:e.entityMap};default:return{}}}function W(e,t,n){let o=n(t);return e.entityMap[o]?(e.entityMap[o]=t,l.Entities):(e.entityMap[o]=t,e.ids.push(o),l.Both)}function nt(e,t,n){let o=l.None;for(let i of t){let r=W(e,i,n);o!==l.Both&&(o=r)}return o}function j(e,t){let n=P(t),o=I(t);return i=>{let r=tt(i,o),a=W(r,e,n);return et(r,o,a)}}function F(e,t){let n=P(t),o=I(t);return()=>{let i={entityMap:{},ids:[]};return nt(i,e,n),{[o.entityMapKey]:i.entityMap,[o.idsKey]:i.ids}}}function N(e){let{entityMapKey:t,idsKey:n,entitiesKey:o}=I(e);return h(b({[t]:{},[n]:[]}),S(i=>({[o]:f(()=>{let r=i[t]();return i[n]().map(c=>r[c])})})))}var w=()=>({requestStatus:"pending"}),M=()=>({requestStatus:"fulfilled"}),g=e=>({requestStatus:{error:e}}),T=()=>h(b({requestStatus:"idle"}),S(({requestStatus:e})=>({isPending:f(()=>e()==="pending"),isFulfilled:f(()=>e()==="fulfilled"),error:f(()=>{let t=e();return typeof t=="object"?t.error:null})})));var It=e=>h(N(),T(),C(t=>{let n=e();return{loadAll:async()=>{if(!n.fetchAll)throw Error("fetchAll loader was not provided");d(t,w());try{let i=await n.fetchAll();return d(t,F(i),M()),i}catch(i){throw g("Something went wrong fetching all entities"),i}},get:async i=>{let a=E(t.entities).find(c=>c.id===i);if(a)return a;if(!n.fetch)throw Error("fetch loader was not provided");d(t,w());try{let c=await n.fetch(i);return d(t,j(c),M()),c}catch(c){let y=`Something went wrong fetching entity with id ${i}. Err: ${c}`;throw g(y),d(t,M()),Error(y)}},add:async i=>{if(!n.create)throw Error("create loader was not provided");d(t,w());try{let r=await n.create(i);return d(t,j(r),M()),r}catch(r){throw g("Something went wrong creating entity"),r}},change:async i=>{if(!n.update)throw Error("update loader was not provided");d(t,w());try{let r=await n.update(i);return d(t,j(r),M()),r}catch(r){throw g("Something went wrong updating entity"),r}}}}));export{d as a,at as b,S as c,dt as d,C as e,b as f,It as g};
