import{b as te}from"./chunk-S76G5ZLK.js";import{f as Z,l as _,q as ee,v as ne}from"./chunk-4YZRLV7F.js";import{$ as G,A as R,B as T,Ic as F,J as W,Jc as Q,Oc as O,P,S as $,W as A,Xc as U,Y as V,_ as B,a as h,b as w,da as Y,e as c,f as C,fb as J,g as y,ga as z,ia as S,la as X,lb as K,ma as N,o as D,r as k,t as q,u as m,wa as H}from"./chunk-UJ7YJEPZ.js";var M=d=>{let i=H(void 0);return Q(p=>{let f=d().subscribe(r=>i.set(r));p(()=>{f.unsubscribe()})}),i};var re=(()=>{var i,p;let a=class a{constructor(){C(this,i,{});C(this,p,{})}registerUIElement(r){let{type:I,component:e}=r;c(this,i)[I]=e}registerUIElementLoader(r){let{type:I,loader:e}=r;c(this,p)[I]=e}getUIElement(r){let I=c(this,i)[r];if(!I){let e=c(this,p)[r];if(e)return e();throw new Error(`${r} has not been registered as a UI Element yet!`)}return Promise.resolve(I)}};i=new WeakMap,p=new WeakMap,a.\u0275fac=function(I){return new(I||a)},a.\u0275prov=Y({token:a,factory:a.\u0275fac,providedIn:"root"});let d=a;return d})();var ie=new z("ELEMENT_RENDERER_CONFIG"),Te=(()=>{var i,p,a,f;let r=class r{constructor(){C(this,i);C(this,p);C(this,a);C(this,f);y(this,i,S(X)),y(this,p,S(ne)),y(this,a,S(re)),this.interpolationService=S(_),this.viewContainerRef=S(J),this.elementRendererConfig=S(ie,{optional:!0}),y(this,f,this.elementRendererConfig?.uiElementWrapperComponent),this.uiElementTemplateId=O.required({alias:"djuiUIElementRenderer"}),this.requiredComponentSymbols=O([]),this.configsOverride=O({}),this.uiElementTemplate=M(()=>c(this,p).getTemplate(this.uiElementTemplateId())),this.uiElementComponent=M(()=>{let e=this.uiElementTemplate();return!e||!e.config?m(void 0):q(c(this,a).getUIElement(e.config.type))}),this.elementInterpolationContext=F(()=>{let e=this.uiElementTemplate();if(!e||e.status!=="loaded")return null;let{remoteResourceIds:t,stateSubscription:n}=e.config,o=n?N(c(this,i),()=>ee(n,`UI Element ${e.id}`)):m(null),l=t?.length?N(c(this,i),()=>te(t)):m(null);return T({remoteResourcesStates:l,state:o}).pipe(A({refCount:!0,bufferSize:1}))}),this.componentInputsStream=F(()=>{let e=this.uiElementTemplate(),t=this.elementInterpolationContext();if(e?.status!=="loaded"||!t)return null;let{config:{options:n,remoteResourceIds:o}}=e,l=o?.length?this.generateInputsFromRemoteResource({elementInterpolationContext$:t}):{isResourceLoading:m(!1),isResourceError:m(!1)},g=this.generateInputsWithInterpolationTracking({templateOptions:n,elementInterpolationContext$:t}),j={isLoading:T({isResourceLoading:l.isResourceLoading,isInterpolationLoading:g.isInterpolationLoading}).pipe(R(({isResourceLoading:s,isInterpolationLoading:E})=>!!s||!!E)),isError:T({isResourceError:l.isResourceError,isInterpolationError:g.isInterpolationError}).pipe(R(({isResourceError:s,isInterpolationError:E})=>!!s||!!E))},x=Object.entries(this.configsOverride()).reduce((s,[E,b])=>w(h({},s),{[E]:m(b)}),{}),L=h(h(h(h({},l),j),g),x);return Object.fromEntries(Object.entries(L).map(([s,E])=>[s,E.pipe(P(Z),G(500,void 0,{leading:!0,trailing:!0}))]))}),this.componentRequiredInputs=M(()=>{let e=this.componentInputsStream(),t=this.uiElementComponent();if(!e||!t)return m(void 0);let n=this.getComponentRequiredInputs(t),o={};for(let l of n)o[l]=e[l];return Object.keys(o).length===0?m({}):T(o).pipe($())})}checkInputExistsForComponent(e,t){let n=U(e)?.inputs;if(!n)throw new Error("Invalid component");return!!n.find(o=>o.propName===t||o.templateName===t)}getComponentRequiredInputs(e){let t=U(e)?.inputs;if(!t)throw new Error("Invalid component");return t.filter(n=>n.propName.includes("RequiredConfigOption")).map(n=>n.templateName)}generateInputsWithInterpolationTracking(e){let{templateOptions:t,elementInterpolationContext$:n}=e,o=new D({}),l=o.asObservable().pipe(R(u=>!Object.values(u).every(s=>!s))),g=new D({}),j=g.asObservable().pipe(R(u=>!Object.values(u).every(s=>!s))),x={isInterpolationLoading:l,isInterpolationError:j},L={};for(let[u,s]of Object.entries(t)){let E=this.interpolationService.checkForInterpolation(s);L[u]=E?n.pipe(V(b=>{let v=structuredClone(o.getValue());return v[u]=!0,o.next(v),this.interpolationService.interpolate({context:b,value:s})}),W(b=>{let v=structuredClone(g.getValue());return v[u]=!0,g.next(v),console.warn(`Fail to interpolate ${u}. Error: ${b}`),k}),B({next:()=>{let b=structuredClone(g.getValue());b[u]=!1,g.next(b);let v=structuredClone(o.getValue());v[u]=!1,o.next(v)}})):m(s)}return h(h({},x),L)}generateInputsFromRemoteResource(e){let{elementInterpolationContext$:t}=e;return{isResourceLoading:t.pipe(R(n=>!!n.remoteResourcesStates?.isPartialLoading.length)),isResourceError:t.pipe(R(n=>!!n.remoteResourcesStates?.isPartialError.length))}}hasCorrectComponentSymbol(e,t){let n=e.ELEMENT_SYMBOL;return!(t.length&&!t.includes(n))}getUIElementWrapper(e){if(!c(this,f))return null;let t=c(this,f).EXCLUDED_ELEMENTS;return t&&!t.has(e)?this.viewContainerRef.createComponent(c(this,f)):null}};i=new WeakMap,p=new WeakMap,a=new WeakMap,f=new WeakMap,r.\u0275fac=function(t){return new(t||r)},r.\u0275dir=K({type:r,inputs:{uiElementTemplateId:[1,"djuiUIElementRenderer","uiElementTemplateId"],requiredComponentSymbols:[1,"requiredComponentSymbols"],configsOverride:[1,"configsOverride"]}});let d=r;return d})();export{re as a,ie as b,Te as c};
