import{a as L,b as V,c as Y}from"./chunk-YQ4QG3WP.js";import"./chunk-N2LQX7VI.js";import{b as A,c as U}from"./chunk-EGESUMOZ.js";import{c as E}from"./chunk-5BGIWNYG.js";import{d as k,f as J}from"./chunk-UV6WKCAY.js";import"./chunk-PBNNIOL7.js";import"./chunk-ZN2IF2HT.js";import"./chunk-VKEGRMF3.js";import"./chunk-PZF2HUG4.js";import"./chunk-VJSJECHS.js";import"./chunk-XVVGP5IS.js";import"./chunk-5FDWUNFG.js";import{c as z}from"./chunk-ABBLJOL2.js";import"./chunk-POD54P5Y.js";import"./chunk-GDV3UKUI.js";import"./chunk-GLMHSY4W.js";import"./chunk-5YWNGEST.js";import"./chunk-VL445OHB.js";import"./chunk-NNKYQBUS.js";import{ba as O}from"./chunk-PAE2UDOJ.js";import{c as B}from"./chunk-VCLEF7AH.js";import{f as $}from"./chunk-GB6ZAWWW.js";import"./chunk-T2KM2H3G.js";import"./chunk-6O3Z2ZPM.js";import"./chunk-WBS7JUSK.js";import"./chunk-A4TQDYN4.js";import"./chunk-KGG7IXI2.js";import{A as j,Ab as w,Bb as D,Fb as _,Gb as f,Hb as y,Hc as C,Ib as S,Ic as h,Lc as F,Nc as N,Oc as P,Tb as v,_a as R,a as M,e as t,f as p,g as m,ia as g,jb as b,qc as I,rc as q}from"./chunk-UJ7YJEPZ.js";var H={$schema:"https://json-schema.org/draft/2020-12/schema",description:"AppEditRemoteResourceSchema",type:"object",properties:{stateSubscription:{type:"object",properties:{watchedScopes:{type:"object",properties:{global:{type:"array",items:{type:"string"}},local:{type:"array",items:{type:"string"}}},additionalProperties:!1},variables:{type:"object",propertyNames:{type:"string"},additionalProperties:{}}},additionalProperties:!1},options:{type:"object",properties:{runCondition:{type:"boolean"},requests:{type:"array",items:{type:"object",properties:{fetcherId:{type:"string"},configs:{},interpolation:{type:"string",pattern:"^(<\\${)([\\s\\S]*?)(}\\$>)$"}},required:["fetcherId","configs"],additionalProperties:!1}},onSuccess:{type:"array",items:{type:"object",properties:{type:{type:"string"},payload:{}},required:["type"],additionalProperties:!1}},parallel:{type:"boolean"}},required:["requests"],additionalProperties:!1},name:{type:"string"},description:{type:"string"}},required:["options","name","description"],additionalProperties:!1};var W=()=>({}),Q=(()=>{var r,n,s,l,d;let a=class a{constructor(){p(this,r);p(this,n);p(this,s);p(this,l);p(this,d);m(this,r,g(U)),m(this,n,g($)),m(this,s,g(O)),this.id=P.required(),this.visible=P.required(),this.editCancel=N(),this.loadingSig=h(()=>t(this,r).isPending()),this.jsonSchemaConfig={schema:H,schemaId:"remoteResourceEditSchema"},m(this,l,h(()=>{let e=this.id();return t(this,r).entities().filter(i=>i.id===e)})),m(this,d,h(()=>{let e=t(this,l).call(this);return e.length<=0?null:(e.length>1&&console.warn(`Multiple UIE templates with the same ID of ${C(this.id)} detected. This could be an error. The first one will be selected for editing`),e[0])})),this.currentEditableFieldsSig=h(()=>{let e=t(this,d).call(this);if(!e)return null;let{name:i,description:o,stateSubscription:c,options:T}=e;return{name:i,description:o,stateSubscription:c,options:T}})}async updateUIElementTemplate(e){let i=JSON.parse(e),o=C(t(this,d));if(!o)return;let c=M(M({},o),i);await t(this,r).change(c),C(t(this,r).error)?t(this,s).add({severity:"error",summary:"Template saved failure",detail:"Your remote resource template could not be saved, please try again later or refresh the page",life:9999}):(t(this,s).add({severity:"success",summary:"Template saved successfully",detail:"Your remote resource template has been successfully saved",life:3e3}),t(this,n).updateTemplate(c))}};r=new WeakMap,n=new WeakMap,s=new WeakMap,l=new WeakMap,d=new WeakMap,a.\u0275fac=function(i){return new(i||a)},a.\u0275cmp=b({type:a,selectors:[["prime-ng-playground-builder-feat-raw-remote-resource-template-editor-modal"]],inputs:{id:[1,"id"],visible:[1,"visible"]},outputs:{editCancel:"editCancel"},features:[I([O])],decls:2,vars:5,consts:[[3,"editCancel","save","isLoading","isOpen","jsonObj","schemaConfig"],[1,"toast"]],template:function(i,o){i&1&&(f(0,"prime-ng-playground-builder-feat-json-editor-modal",0),v("editCancel",function(){return o.editCancel.emit()})("save",function(T){return o.updateUIElementTemplate(T)}),y(),S(1,"p-toast",1)),i&2&&_("isLoading",o.loadingSig())("isOpen",o.visible())("jsonObj",o.currentEditableFieldsSig()??q(4,W))("schemaConfig",o.jsonSchemaConfig)},dependencies:[Y,L],styles:["[_nghost-%COMP%]{display:contents}[_nghost-%COMP%]     .p-dialog-mask{z-index:9998!important}[_nghost-%COMP%]   .toast[_ngcontent-%COMP%]{z-index:10000}"],changeDetection:0});let u=a;return u})();function X(u,r){u&1&&(f(0,"div",1),S(1,"prime-ng-playground-shared-json-editor",3),y()),u&2&&(R(),_("configs",r))}var be=(()=>{var r,n,s,l,d;let a=class a{constructor(){p(this,r);p(this,n);p(this,s);p(this,l);p(this,d);m(this,r,g(B)),m(this,n,g(k)),m(this,s,g(J)),this.currentRemoteResourceTemplateId=t(this,n).snapshot.params.id,this.remoteResourceStateSig=E(t(this,r).getRemoteResourceState(this.currentRemoteResourceTemplateId)),m(this,l,"editRawTemplate"),this.isRawTemplateEditorModalOpenSig=E(t(this,n).queryParams.pipe(j(e=>e[t(this,l)]==="true")),{initialValue:!1}),this.editorConfig={readonly:!0},m(this,d,F({params:()=>({remoteResourceState:this.remoteResourceStateSig()}),loader:({params:e})=>{let{remoteResourceState:i}=e;return!i||i.status!=="completed"?Promise.resolve(void 0):V(JSON.stringify(i.result))}})),this.editorConfigSig=h(()=>{let e=t(this,d).value();return e?{readonly:!0,initialValue:e}:null})}toggleModal(e){t(this,s).navigate([],{relativeTo:t(this,n),queryParams:{[t(this,l)]:e?!0:null},queryParamsHandling:"merge"})}};r=new WeakMap,n=new WeakMap,s=new WeakMap,l=new WeakMap,d=new WeakMap,a.\u0275fac=function(i){return new(i||a)},a.\u0275cmp=b({type:a,selectors:[["prime-ng-playground-builder-feat-edit-remote-resource-template"]],decls:3,vars:3,consts:[["aria-label","Open template editor","icon","pi pi-file-edit","iconPos","bottom","label","Open template editor",1,"open-template-editor-btn",3,"click"],[1,"editor-container"],[3,"editCancel","id","visible"],[3,"configs"]],template:function(i,o){if(i&1&&(f(0,"p-button",0),v("click",function(){return o.toggleModal(!0)}),y(),w(1,X,2,1,"div",1),f(2,"prime-ng-playground-builder-feat-raw-remote-resource-template-editor-modal",2),v("editCancel",function(){return o.toggleModal(!1)}),y()),i&2){let c;R(),D((c=o.editorConfigSig())?1:-1,c),R(),_("id",o.currentRemoteResourceTemplateId)("visible",o.isRawTemplateEditorModalOpenSig())}},dependencies:[Q,z,A],styles:["[_nghost-%COMP%]{position:relative;display:flex;justify-content:center;align-items:center;height:calc(100vh - 50px)}[_nghost-%COMP%]   .editor-container[_ngcontent-%COMP%]{width:75vw;height:75vh}[_nghost-%COMP%]   .open-template-editor-btn[_ngcontent-%COMP%]{position:absolute;z-index:9997;top:1rem;right:1rem;opacity:.1;transition:opacity .2s ease-in}[_nghost-%COMP%]   .open-template-editor-btn[_ngcontent-%COMP%]:hover{opacity:1}"],changeDetection:0});let u=a;return u})();export{be as EditRemoteResourceTemplateComponent};
