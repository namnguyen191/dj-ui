import{a as L,b as V,c as Y}from"./chunk-IC4OMNSZ.js";import"./chunk-N2LQX7VI.js";import{b as z,c as A}from"./chunk-FLT6BDNU.js";import{c as j}from"./chunk-X3WHHN2J.js";import{d as $,f as k}from"./chunk-UV6WKCAY.js";import"./chunk-JZKNT5UY.js";import"./chunk-PAKE6HTN.js";import"./chunk-VKEGRMF3.js";import"./chunk-PZF2HUG4.js";import"./chunk-HWPYVJFX.js";import"./chunk-EQ2RW2R3.js";import"./chunk-5FDWUNFG.js";import{c as U}from"./chunk-ABBLJOL2.js";import"./chunk-POD54P5Y.js";import"./chunk-GDV3UKUI.js";import"./chunk-GLMHSY4W.js";import"./chunk-5YWNGEST.js";import"./chunk-UY5E22NZ.js";import"./chunk-LP6QDAMA.js";import{ba as O}from"./chunk-PAE2UDOJ.js";import{g as J,i as B}from"./chunk-3C3QOQZR.js";import"./chunk-LPEJ2UBE.js";import"./chunk-6O3Z2ZPM.js";import"./chunk-WBS7JUSK.js";import"./chunk-WIY5O4WM.js";import"./chunk-BGKRRNHO.js";import{A as E,Ab as q,Bb as w,Fb as b,Gb as y,Hb as h,Hc as C,Ib as S,Ic as f,Lc as N,Nc as F,Oc as M,Tb as _,_a as v,a as P,e as t,f as l,g as m,ia as g,jb as R,qc as I,rc as D}from"./chunk-UJ7YJEPZ.js";var H={$schema:"https://json-schema.org/draft/2020-12/schema",description:"AppEditRemoteResourceSchema",type:"object",properties:{stateSubscription:{type:"object",properties:{watchedScopes:{type:"object",properties:{global:{type:"array",items:{type:"string"}},local:{type:"array",items:{type:"string"}}},additionalProperties:!1},variables:{type:"object",propertyNames:{type:"string"},additionalProperties:{}}},additionalProperties:!1},options:{type:"object",properties:{runCondition:{type:"boolean"},requests:{type:"array",items:{anyOf:[{type:"object",properties:{fetcherId:{type:"string",const:"httpFetcher"},configs:{type:"object",properties:{endpoint:{type:"string"},method:{type:"string"},body:{},headers:{type:"object",propertyNames:{type:"string"},additionalProperties:{type:"string"}}},required:["endpoint","method"],additionalProperties:!1},interpolation:{$ref:"#/$defs/__schema0"}},required:["fetcherId","configs"],additionalProperties:!1},{type:"object",properties:{fetcherId:{type:"string",const:"fileUpload"},configs:{type:"object",properties:{endpoint:{type:"string"},responseType:{anyOf:[{type:"string",const:"text"},{type:"string",const:"json"}]},file:{type:"string"}},required:["endpoint","file"],additionalProperties:!1},interpolation:{$ref:"#/$defs/__schema0"}},required:["fetcherId","configs"],additionalProperties:!1}]}},onSuccess:{type:"array",items:{anyOf:[{type:"object",properties:{type:{type:"string",const:"addToState"},payload:{type:"object",properties:{scope:{type:"string",enum:["global","local"]},data:{type:"object",propertyNames:{type:"string"},additionalProperties:{}}},required:["scope","data"],additionalProperties:!1}},required:["type","payload"],additionalProperties:!1},{type:"object",properties:{type:{type:"string",const:"triggerRemoteResource"},payload:{type:"object",properties:{remoteResourceId:{type:"string"}},required:["remoteResourceId"],additionalProperties:!1}},required:["type","payload"],additionalProperties:!1},{type:"object",properties:{type:{type:"string",const:"navigate"},payload:{type:"object",properties:{navigationType:{anyOf:[{type:"string",const:"internal"},{type:"string",const:"external"}]},url:{type:"string"}},required:["navigationType","url"],additionalProperties:!1}},required:["type","payload"],additionalProperties:!1}]}},parallel:{type:"boolean"}},required:["requests"],additionalProperties:!1}},required:["options"],additionalProperties:!1,$defs:{__schema0:{type:"string",pattern:"^(<\\${)([\\s\\S]*?)(}\\$>)$"}}};var K=()=>({}),Q=(()=>{var r,n,s,p,d;let a=class a{constructor(){l(this,r);l(this,n);l(this,s);l(this,p);l(this,d);m(this,r,g(A)),m(this,n,g(J)),m(this,s,g(O)),this.id=M.required(),this.visible=M.required(),this.editCancel=F(),this.loadingSig=f(()=>t(this,r).isPending()),this.jsonSchemaConfig={schema:H,schemaId:"remoteResourceEditSchema"},m(this,p,f(()=>{let e=this.id();return t(this,r).entities().filter(i=>i.id===e)})),m(this,d,f(()=>{let e=t(this,p).call(this);return e.length<=0?null:(e.length>1&&console.warn(`Multiple UIE templates with the same ID of ${C(this.id)} detected. This could be an error. The first one will be selected for editing`),e[0])})),this.currentEditableFieldsSig=f(()=>{let e=t(this,d).call(this);if(!e)return null;let{name:i,description:o,stateSubscription:c,options:T}=e;return{name:i,description:o,stateSubscription:c,options:T}})}async updateUIElementTemplate(e){let i=JSON.parse(e),o=C(t(this,d));if(!o)return;let c=P(P({},o),i);await t(this,r).change(c),C(t(this,r).error)?t(this,s).add({severity:"error",summary:"Template saved failure",detail:"Your remote resource template could not be saved, please try again later or refresh the page",life:9999}):(t(this,s).add({severity:"success",summary:"Template saved successfully",detail:"Your remote resource template has been successfully saved",life:3e3}),t(this,n).updateTemplate(c))}};r=new WeakMap,n=new WeakMap,s=new WeakMap,p=new WeakMap,d=new WeakMap,a.\u0275fac=function(i){return new(i||a)},a.\u0275cmp=R({type:a,selectors:[["prime-ng-playground-builder-feat-raw-remote-resource-template-editor-modal"]],inputs:{id:[1,"id"],visible:[1,"visible"]},outputs:{editCancel:"editCancel"},features:[I([O])],decls:2,vars:5,consts:[[3,"editCancel","save","isLoading","isOpen","jsonObj","schemaConfig"],[1,"toast"]],template:function(i,o){i&1&&(y(0,"prime-ng-playground-builder-feat-json-editor-modal",0),_("editCancel",function(){return o.editCancel.emit()})("save",function(T){return o.updateUIElementTemplate(T)}),h(),S(1,"p-toast",1)),i&2&&b("isLoading",o.loadingSig())("isOpen",o.visible())("jsonObj",o.currentEditableFieldsSig()??D(4,K))("schemaConfig",o.jsonSchemaConfig)},dependencies:[Y,L],styles:["[_nghost-%COMP%]{display:contents}[_nghost-%COMP%]     .p-dialog-mask{z-index:9998!important}[_nghost-%COMP%]   .toast[_ngcontent-%COMP%]{z-index:10000}"],changeDetection:0});let u=a;return u})();function W(u,r){u&1&&(y(0,"div",1),S(1,"prime-ng-playground-shared-json-editor",3),h()),u&2&&(v(),b("configs",r))}var Re=(()=>{var r,n,s,p,d;let a=class a{constructor(){l(this,r);l(this,n);l(this,s);l(this,p);l(this,d);m(this,r,g(B)),m(this,n,g($)),m(this,s,g(k)),this.currentRemoteResourceTemplateId=t(this,n).snapshot.params.id,this.remoteResourceStateSig=j(t(this,r).getRemoteResourceState(this.currentRemoteResourceTemplateId)),m(this,p,"editRawTemplate"),this.isRawTemplateEditorModalOpenSig=j(t(this,n).queryParams.pipe(E(e=>e[t(this,p)]==="true")),{initialValue:!1}),this.editorConfig={readonly:!0},m(this,d,N({params:()=>({remoteResourceState:this.remoteResourceStateSig()}),loader:({params:e})=>{let{remoteResourceState:i}=e;return!i||i.status!=="completed"?Promise.resolve(void 0):V(JSON.stringify(i.result))}})),this.editorConfigSig=f(()=>{let e=t(this,d).value();return e?{readonly:!0,initialValue:e}:null})}toggleModal(e){t(this,s).navigate([],{relativeTo:t(this,n),queryParams:{[t(this,p)]:e?!0:null},queryParamsHandling:"merge"})}};r=new WeakMap,n=new WeakMap,s=new WeakMap,p=new WeakMap,d=new WeakMap,a.\u0275fac=function(i){return new(i||a)},a.\u0275cmp=R({type:a,selectors:[["prime-ng-playground-builder-feat-edit-remote-resource-template"]],decls:3,vars:3,consts:[["aria-label","Open template editor","icon","pi pi-file-edit","iconPos","bottom","label","Open template editor",1,"open-template-editor-btn",3,"click"],[1,"editor-container"],[3,"editCancel","id","visible"],[3,"configs"]],template:function(i,o){if(i&1&&(y(0,"p-button",0),_("click",function(){return o.toggleModal(!0)}),h(),q(1,W,2,1,"div",1),y(2,"prime-ng-playground-builder-feat-raw-remote-resource-template-editor-modal",2),_("editCancel",function(){return o.toggleModal(!1)}),h()),i&2){let c;v(),w((c=o.editorConfigSig())?1:-1,c),v(),b("id",o.currentRemoteResourceTemplateId)("visible",o.isRawTemplateEditorModalOpenSig())}},dependencies:[Q,U,z],styles:["[_nghost-%COMP%]{position:relative;display:flex;justify-content:center;align-items:center;height:calc(100vh - 50px)}[_nghost-%COMP%]   .editor-container[_ngcontent-%COMP%]{width:75vw;height:75vh}[_nghost-%COMP%]   .open-template-editor-btn[_ngcontent-%COMP%]{position:absolute;z-index:9997;top:1rem;right:1rem;opacity:.1;transition:opacity .2s ease-in}[_nghost-%COMP%]   .open-template-editor-btn[_ngcontent-%COMP%]:hover{opacity:1}"],changeDetection:0});let u=a;return u})();export{Re as EditRemoteResourceTemplateComponent};
