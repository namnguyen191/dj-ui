import{a as M,c as A,e as Ee,g as fe,i as Ce,l as ge,o as he,q as _e}from"./chunk-AC577EVM.js";import{a as Ie}from"./chunk-FQHWX7XN.js";import{f as S,g as F}from"./chunk-LMQLNWY7.js";import{$a as te,$c as de,Ba as U,Bb as ie,Ca as ee,Cb as $,Cc as _,D as P,Ec as v,Fc as le,Gc as me,H as Q,Hb as x,K as Y,Mb as j,Nb as V,Pb as re,Qb as se,R as K,Rb as k,T as O,Tc as ce,U as z,Ub as b,V as G,Vc as ue,W as J,ac as ae,bc as pe,da as d,dc as w,f as D,fb as W,g as y,i as H,ia as X,ib as ne,ja as L,k as B,l as g,mb as oe,r as h,s as T,tb as I,za as Z}from"./chunk-RVPXDSFJ.js";import{a as C,b as N}from"./chunk-Q7L6LLAK.js";var q=o=>{let{ele:m,attrName:e,attrValue:t}=o,n=m.parentElement;for(;n;){if(n.getAttribute(e)===t)return!0;n=n.parentElement}return!1};var Te=["uiElementVCR"];function xe(o,m){o&1&&k(0,null,0)}function be(o,m){o&1&&k(0)}function ve(o,m){if(o&1&&I(0,be,1,0,"ng-container",2),o&2){let e=b(4);$("ngComponentOutlet",e.uiElementLoadingComponent)}}function Se(o,m){o&1&&(j(0,"span"),w(1,"Loading UI component...."),V())}function Re(o,m){if(o&1&&I(0,ve,1,1,"ng-container")(1,Se,2,0,"span"),o&2){let e=b(3);x(e.uiElementLoadingComponent?0:1)}}function ye(o,m){if(o&1&&(re(0),I(1,xe,2,0,"ng-container")(2,Re,2,1),se()),o&2){let e=m.ngIf;te(),x(e.status==="loaded"?1:2)}}function Oe(o,m){if(o&1&&I(0,ye,3,1,"ng-container",1),o&2){let e=b();$("ngIf",e.uiElementTemplate())}}function Le(o,m){o&1&&(j(0,"span"),w(1,"Infinte loop in rendering element detected"),V())}var Je=(()=>{class o{#o;#i;#e;#t;#r;#s;#a;#n;#p;constructor(){this.#o=d(_e),this.#i=d(Ie),this.#e=d(Ce),this.#t=d(X),this.#r=d(fe),this.#s=d(ee),this.uiElementInstance=U.required(),this.requiredComponentSymbols=U([]),this.uiElementTemplateId=_(()=>this.uiElementInstance().uiElementTemplateId),this.uiElementVCR=ne("uiElementVCR",{read:W}),this.uiElementTemplate=M(()=>this.#i.getTemplate(this.uiElementTemplateId())),this.uiElementComponent=M(()=>{let e=this.uiElementTemplate();return!e||!e.config?g(void 0):B(this.#o.getUIElement(e.config.type))}),this.#a=_(()=>{let e=this.uiElementVCR(),t=this.uiElementComponent();if(!e||!t)return null;e.clear();let n=v(this.uiElementTemplateId),s=t.ELEMENT_SYMBOL,p=this.requiredComponentSymbols();if(p.length&&!p.includes(s))return S(`${n}: Wrong element received: expect ${p.map(r=>String(r)).join("or ")} but got ${String(s)}`),null;if(this.uiElementExtraWrapperComponent){let r=e.createComponent(this.uiElementExtraWrapperComponent),E=v(this.uiElementInstance),l=v(this.uiElementTemplate);r.setInput("uiElementInstance",E),r.setInput("uiElementTemplate",l);let c=r.instance.uiElementVCR();if(!c)return null;let i=c.createComponent(t);return r.setInput("uiElementComponentRef",i),i}return e.createComponent(t)}),this.#n=_(()=>{let e=this.uiElementTemplate();if(!e||e.status!=="loaded")return null;let{remoteResourceIds:t,stateSubscription:n}=e.config,s=n?L(this.#t,()=>ge(n)):g(null),p=t?.length?L(this.#t,()=>he(t)):g(null);return T({remoteResourcesStates:p,state:s}).pipe(K({refCount:!0,bufferSize:1}))}),this.#p=_(()=>{let e=this.uiElementTemplate(),t=this.#n();if(e?.status!=="loaded"||!t)return null;let{config:{options:n,remoteResourceIds:s}}=e,p=s?.length?this.#u({elementInterpolationContext$:t}):{isResourceLoading:g(!1),isResourceError:g(!1)},r=this.#c({templateOptions:n,elementInterpolationContext$:t}),E={isLoading:T({isResourceLoading:p.isResourceLoading,isInterpolationLoading:r.isInterpolationLoading}).pipe(h(({isResourceLoading:i,isInterpolationLoading:a})=>i||a)),isError:T({isResourceError:p.isResourceError,isInterpolationError:r.isInterpolationError}).pipe(h(({isResourceError:i,isInterpolationError:a})=>i||a))},l=C(C(C({},p),E),r);return Object.fromEntries(Object.entries(l).map(([i,a])=>[i,a.pipe(Y(Ee),J(500,void 0,{leading:!0,trailing:!0}))]))}),this.isInfinite=_(()=>{let e=this.uiElementTemplateId(),t=this.#s.nativeElement,n=q({ele:t,attrName:"elementTemplateId",attrValue:e});return n&&console.error(`UI element with id ${e} has already existed in parents`),n}),this.uiElementLoadingComponent=d(A,{optional:!0})?.uiElementLoadingComponent,this.uiElementExtraWrapperComponent=d(A,{optional:!0})?.uiElementExtraWrapperComponent,this.#l()}#l(){le(e=>{let t=this.#p(),n=this.#a(),s=this.uiElementTemplate(),p=this.#n();if(!t||!n||s?.status!=="loaded"||!p)return;let r=new D;e(()=>{r.next(),r.complete()});for(let[l,c]of Object.entries(t))this.#m(n.componentType,l)?c.pipe(z(r)).subscribe(i=>{F(`[${this.uiElementTemplateId()}] Input stream for ${l}`),n.setInput(l,i)}):S(`Input ${l} does not exist for component ${n.instance.getElementType()}`);let{eventsHooks:E}=s.config;if(E)for(let[l,c]of Object.entries(E)){let i=n.instance[l];if(!i||!(i instanceof Z))S(`Element ${n.instance.getElementType()} has no support for event "${l}"`);else{let a=p.pipe(Q(1));i.subscribe(R=>{a.pipe(O(u=>this.#e.interpolate({value:c,context:N(C({},u),{$eventOutput:R})}))).subscribe(u=>{F(`Output stream for ${this.uiElementTemplateId()}`),this.#r.triggerActionHooks(u)})})}}})}#m(e,t){let n=me(e)?.inputs;if(!n)throw new Error("Invalid component");return!!n.find(s=>s.propName===t||s.templateName===t)}#c(e){let{templateOptions:t,elementInterpolationContext$:n}=e,s=new y({}),p=s.asObservable().pipe(h(i=>!Object.values(i).every(a=>!a))),r=new y({}),E=r.asObservable().pipe(h(i=>!Object.values(i).every(a=>!a))),l={isInterpolationLoading:p,isInterpolationError:E},c={};for(let[i,a]of Object.entries(t)){let R=this.#e.checkForInterpolation(a);c[i]=R?n.pipe(O(u=>{let f=structuredClone(s.getValue());return f[i]=!0,s.next(f),this.#e.interpolate({context:u,value:a})}),P(u=>{let f=structuredClone(r.getValue());return f[i]=!0,r.next(f),console.warn(`Fail to interpolate ${i}. Error: ${u}`),H}),G({next:()=>{let u=structuredClone(r.getValue());u[i]=!1,r.next(u);let f=structuredClone(s.getValue());f[i]=!1,s.next(f)}})):g(a)}return C(C({},l),c)}#u(e){let{elementInterpolationContext$:t}=e;return{isResourceLoading:t.pipe(h(n=>!!n.remoteResourcesStates?.isPartialLoading.length)),isResourceError:t.pipe(h(n=>!!n.remoteResourcesStates?.isPartialError.length))}}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=oe({type:o,selectors:[["dj-ui-element-wrapper"]],viewQuery:function(t,n){t&1&&ae(n.uiElementVCR,Te,5,W),t&2&&pe()},hostVars:1,hostBindings:function(t,n){t&2&&ie("elementTemplateId",n.uiElementTemplateId())},inputs:{uiElementInstance:[1,"uiElementInstance"],requiredComponentSymbols:[1,"requiredComponentSymbols"]},decls:2,vars:1,consts:[["uiElementVCR",""],[4,"ngIf"],[4,"ngComponentOutlet"]],template:function(t,n){t&1&&I(0,Oe,1,1,"ng-container")(1,Le,2,0,"span"),t&2&&x(n.isInfinite()?1:0)},dependencies:[de,ce,ue],encapsulation:2,changeDetection:0})}}return o})();export{q as a,Je as b};
